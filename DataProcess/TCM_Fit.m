% 参数（从STM32拟合得到）
y0 = 589.58;       % 初始高度 (m)
vy0 = 64.37;       % 初始垂直速度 (m/s)
alpha = 0.07;   % 阻力系数 k/m
g = 9.79136;       % 重力加速度

% 时间序列（与你实测的时间点一致）
dt = 0.1;                           % 采样间隔
t = 0.1:dt:12.1;                         % 模拟5秒
N = length(t);

% 高度递推数组
y_pred = zeros(1,N);

for i = 1:N
    ti = t(i);
    % 线性空气阻力高度公式
    y_pred(i) = y0 + (1/alpha)*(vy0 + g/alpha)*(1 - exp(-alpha*ti)) - (g/alpha)*ti;
end

% ======== 实测高度 (例如从传感器采集的值) =========

% 有实测的四组数据用来优化参数，记录于NWPU长安,y1是一次发射；其余是一次发射
y1 = [681, 682, 683, 683, 685, 686, 688, 690, 693, 696, 699, 702, 706, 711, 715, 719, 724, 728, 731, 735, 739, 743, 746, 750, 753, 756, 760, 763, 765, 768, 770, 773, 775, 777, 779, 781, 783, 784, 786, 787, 789, 790, 791, 792, 793, 794, 795, 795, 796, 796, 797, 797, 797, 797, 797, 797, 797, 796, 796, 795, 794, 794, 793, 792, 791, 790, 788, 787, 785, 784, 782, 780, 779, 777, 776, 774, 771, 769, 767, 767, 765, 764, 763, 761, 761, 760, 760, 760, 759, 759, 759, 758, 758, 757, 757, 756, 756, 756, 755, 755, 754, 754, 754, 754, 753, 753, 752, 752, 752, 751, 751, 751, 750, 750, 750, 749, 749, 749, 748, 748, 748];
y2 = [636, 637, 638, 639, 640, 642, 644, 646, 649, 653, 657, 660, 663, 666, 671, 675, 679, 683, 687, 691, 695, 698, 702, 706, 709, 712, 715, 718, 721, 723, 726, 729, 731, 733, 736, 737, 739, 741, 743, 744, 745, 747, 748, 749, 750, 751, 752, 752, 753, 753, 754, 754, 754, 754, 754, 754, 754, 754, 753, 753, 752, 752, 751, 750, 749, 748, 747, 747, 746, 746, 745, 744, 742, 741, 741, 741, 740, 740, 740, 739, 739, 739, 738, 738, 738, 738, 737, 737, 737, 737, 736, 736, 736, 736, 736, 736, 735, 735, 735, 735, 734, 734, 734, 734, 733, 733, 733, 733, 732, 732, 732, 732, 732, 731, 731, 731, 731, 731, 731, 730, 730];
y3 = [632, 633, 634, 635, 637, 638, 640, 642, 644, 648, 652, 655, 659, 662, 665, 670, 673, 677, 681, 685, 688, 692, 695, 699, 702, 706, 709, 713, 715, 718, 720, 723, 724, 726, 728, 730, 731, 733, 734, 735, 736, 737, 738, 739, 740, 741, 741, 741, 741, 741, 741, 741, 741, 741, 741, 741, 741, 741, 740, 740, 740, 740, 739, 739, 739, 739, 738, 738, 738, 738, 737, 737, 737, 737, 736, 736, 736, 736, 735, 735, 735, 734, 734, 734, 734, 734, 733, 733, 733, 733, 732, 732, 732, 732, 732, 732, 732, 731, 731, 731, 731, 731, 730, 730, 730, 730, 730, 730, 730, 729, 729, 729, 729, 729, 729, 728, 728, 728, 728, 728, 730];
y4 = [628, 630, 631, 632, 634, 636, 639, 642, 646, 649, 653, 658, 662, 666, 671, 677, 683, 688, 692, 697, 700, 704, 707, 710, 713, 715, 717, 719, 721, 722, 725, 726, 727, 727, 727, 728, 728, 728, 728, 728, 728, 728, 728, 727, 726, 726, 725, 725, 725, 724, 724, 724, 723, 723, 723, 723, 722, 722, 721, 721, 720, 720, 720, 719, 719, 719, 718, 718, 718, 717, 717, 716, 716, 716, 715, 715, 715, 714, 714, 714, 714, 713, 713, 712, 712, 712, 711, 711, 711, 710, 710, 710, 709, 709, 708, 708, 708, 707, 707, 707, 706, 706, 705, 705, 705, 704, 704, 704, 703, 703, 702, 702, 702, 701, 701, 700, 700, 700, 699, 699, 730];


y_meas = y2; 
t_meas = 0:dt:(length(y_meas)-1)*dt;


% ======== 画图对比 =========
figure;
plot(t, y_pred, 'b-', 'LineWidth', 2); hold on;
plot(t_meas, y_meas, 'ro--', 'MarkerSize', 6, 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Height (m)');
title('Predicted vs Measured Height (Linear Drag Model)');
legend('Predicted (Model)', 'Measured (Sensor)');
grid on;
