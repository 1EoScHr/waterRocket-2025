% 参数（从STM32拟合得到）
y0 = 634.71;       % 初始高度 (m)
vy0 = 63.95;       % 初始垂直速度 (m/s)
alpha = 0.07;   % 阻力系数 k/m
g = 9.79136;       % 重力加速度

% 时间序列（与你实测的时间点一致）
dt = 0.1;                           % 采样间隔
t = 0.1:dt:12.1;                         % 模拟5秒
N = length(t);

% 高度递推数组
y_pred = zeros(1,N);

for i = 1:N
    ti = t(i);
    % 线性空气阻力高度公式
    y_pred(i) = y0 + (1/alpha)*(vy0 + g/alpha)*(1 - exp(-alpha*ti)) - (g/alpha)*ti;
end

% ======== 实测高度 (例如从传感器采集的值) =========
y_meas = [681, 682, 683, 683, 685, 686, 688, 690, 693, 696, 699, 702, 706, 711, 715, 719, 724, 728, 731, 735, 739, 743, 746, 750, 753, 756, 760, 763, 765, 768, 770, 773, 775, 777, 779, 781, 783, 784, 786, 787, 789, 790, 791, 792, 793, 794, 795, 795, 796, 796, 797, 797, 797, 797, 797, 797, 797, 796, 796, 795, 794, 794, 793, 792, 791, 790, 788, 787, 785, 784, 782, 780, 779, 777, 776, 774, 771, 769, 767, 767, 765, 764, 763, 761, 761, 760, 760, 760, 759, 759, 759, 758, 758, 757, 757, 756, 756, 756, 755, 755, 754, 754, 754, 754, 753, 753, 752, 752, 752, 751, 751, 751, 750, 750, 750, 749, 749, 749, 748, 748, 748]; 
t_meas = 0:dt:(length(y_meas)-1)*dt;

% ======== 画图对比 =========
figure;
plot(t, y_pred, 'b-', 'LineWidth', 2); hold on;
plot(t_meas, y_meas, 'ro--', 'MarkerSize', 6, 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Height (m)');
title('Predicted vs Measured Height (Linear Drag Model)');
legend('Predicted (Model)', 'Measured (Sensor)');
grid on;
